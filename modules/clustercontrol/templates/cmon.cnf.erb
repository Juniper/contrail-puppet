## ClusterControl CMON configuration files
## Generated by Puppet clustercontrol module
## Details at http://www.severalnines.com/docs/clustercontrol-administration-guide/components/cmon-controller/configuration-file

# id and name of cluster that this cmon process is monitoring
# must be unique for each monitored cluster, like server-id in mysql
cluster_id=<%= @cluster_id %>
name=<%= @cluster_name %>

# os = [redhat|debian]
<% if @osfamily == 'Debian' %>os=debian<% else %>os=redhat<% end %>

# operation mode = [controller|agent|dual]
mode=controller
agentless=1

# cluster type = [mysqlcluster|galera|mysql_single|mongodb]
<% if @cluster_type == 'replication' then -%>
type=mysql_single
<% else -%>
type=<%= @cluster_type %>
<% end -%>

# location of mysql basedir, e.g /usr or /usr/local/mysql
mysql_basedir=<%= @mysql_basedir %>
mysql_bindir=<%= @mysql_basedir %>/bin

# cmon DB config - mysql_password is for cmon user
mysql_port=<%= @mysql_cmon_port %>
mysql_hostname=<%= @ip_address %>
mysql_password=<%= @mysql_cmon_password %>

# hostname of the current host
hostname=<%= @ip_address %>

# the user that can ssh without password to the other nodes
os_user=<%= @ssh_user %>

# location of cmon.pid file. The pidfile is written in /tmp by default
pidfile=/var/run/

# logfile is default to syslog
logfile=/var/log/cmon.log

# collection of stats interval
db_stats_collection_interval=30
host_stats_collection_interval=30

<% if @cluster_type != 'mongodb' then -%>
# comma separated list of monitored mysql hosts
mysql_server_addresses=<%= @mysql_server_addresses %>
<% end -%>
monitored_mountpoints=<%= @datadir %>
<% if cluster_type == 'mysqlcluster' then -%>
# comma separated list of data nodes and management nodes in ip/hostname
datanode_addresses=<%= @datanode_addresses %>
mgmnode_addresses=<%= @mgmnode_addresses %>
ndb_connectstring=<%= @ndb_connectstring %>
<% end %>
<% if cluster_type == 'mongodb' then %>
# comma separated list of monitored mongodb hosts in ip:port port [1.2.3.4:27017]
mongodb_server_addresses=<%= @mongodb_server_addresses %>
mongodb_basedir=<%= @mongodb_basedir %>
<% end %>
<% if @mongoarbiter_server_addresses then -%>mongoarbiter_server_addresses=<%= @mongoarbiter_server_addresses %><% end -%>
<% if @mongocfg_server_addresses then -%>mongocfg_server_addresses=<%= @mongocfg_server_addresses %><% end -%>
<% if @mongos_server_addresses then -%>mongos_server_addressess=<%= @mongos_server_addresses %><% end -%>
wwwroot=<%= scope.lookupvar('clustercontrol::params::wwwroot') %>

# SSH settings
ssh_port=<%= @ssh_port %>
ssh_identity=<%= @ssh_identity %>
<% if @rssh_opts then %>
ssh_opts=<%= @rssh_opts %>
<% end %>